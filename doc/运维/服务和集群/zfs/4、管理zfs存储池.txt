ZFS存储池中的磁盘：
    存储池的最基本元素是物理存储器。物理存储器可以是大小至少为 128 MB 的块设备
    存储设备可以是整个磁盘或单个分片，建议使用整个磁盘


创建zfs池的注意事项：
    创建 ZFS 存储池的最简单方法是使用整个物理磁盘
    在从磁盘分区、硬件RAID或基于软件的卷管理器所提供的卷中生成池时，无论从管理、可靠性还是性能的角度而言，ZFS配置都变得越来越复杂

    以下注意事项可能有助于确定如何用其他硬件或软件存储解决方案来配置ZFS：
        如果在硬件RAID阵列上构建ZFS，则需要了解ZFS冗余功能与该阵列所提供的冗余功能之间的关系
        有的配置可能会提供足够的冗余和性能，而有的配置可能不会提供足够的冗余和性能

        可以使用由基于软件的卷管理器(lvm)提供的卷为ZFS构造逻辑设备
        但是，建议不要使用这些配置。尽管ZFS可在这类设备上正常运行，但结果可能是实际性能低于最佳性能

    磁盘由其路径及其设备ID标识。在设备ID信息可用的系统上，这种标识方法允许重新配置设备而无需更新ZFS
    由于设备ID生成和管理可能因系统而异，因此应在移动设备之前导出池，例如在将磁盘从一个控制器移动到另一个控制器之前
    诸如固件更新或其他硬件变化之类的系统事件可能会更改ZFS存储池中的设备ID，导致设备不可用


zfs池类型：
    stripe：与 RAID 0 类似，传说中的带条，需要至少一块硬盘
    mirror：与 RAID 1 类似，磁盘镜像，需要至少两块硬盘
    raidz： 与 RAID 5 类似，一重奇偶校验，需要至少二块硬盘
    raidz2：与 RAID 6 类似，双重奇偶校验，需要至少三块硬盘
    raidz3：三重奇偶校验，独门秘籍，需要至少四块硬盘
    log device (ZIL): 高速写缓存设备，需要至少一个专用的存储设备，推荐使用 SSD 固态硬盘
    cache device (L2ARC): 高速读缓存设备，需要至少一个专用的存储设备，推荐使用 SSD 固态硬盘


zfs镜像池：
    zpool create tank mirror /dev/sdb /dev/sdc             #创建镜像存储池(类似于raid中的进行卷)
    ZFS镜像支持以下操作：
        向现有镜像配置中添加用于其他顶层虚拟设备的另一组磁盘
        向现有镜像配置中附加其他磁盘。或向非复制配置中附加其他磁盘，以创建镜像配置
        只要替换磁盘的大小大于或等于要被替换的设备，便可替换现有镜像配置中的一个或多个磁盘
        只要剩余设备可为配置提供足够冗余，便可分离镜像配置中的磁盘
        通过分离其中一个磁盘来分割镜像配置，以创建新的相同池

        不能直接从镜像存储池中移除非备用设备、非日志设备或非缓存设备


创建RAID-Z存储池：
    zpool create tank raidz /dev/sdb /dev/sdc /dev/sdd                        #创建raidz
    zpool create tank raidz2 /dev/sdb /dev/sdc /dev/sdd /dev/sde              #创建raidz2
    zpool create tank raidz3 /dev/sdb /dev/sdc /dev/sdd /dev/sde /dev/sdf     #创建raidz3

    目前，ZFS RAID-Z支持以下操作：
        向现有 RAID-Z 配置中添加用于其他顶层虚拟设备的另一组磁盘
        只要 RAID-Z 磁盘的大小大于或等于要被替换的设备，便可替换现有镜像配置中的一个或多个磁盘


使用日志设备创建ZFS存储池：
    通过实施单独的日志设备获得的任何性能改进均取决于设备类型、池的硬件配置，以及应用程序工作负荷
    可以取消复制或取消镜像日志设备，但日志设备不支持RAID-Z
    可以将日志设备作为较大存储池的一部分进行添加、替换、移除、附加、分离，以及导入和导出
    可以将日志设备附加到现有日志设备，以创建镜像日志设备。此操作等同于在未镜像的存储池中附加设备
    日志设备的最小大小与池中每个设备的最小大小 (64 MB) 相同。可能存储在日志设备中的相关的数据量相对较小。提交日志事务时将释放日志块
    日志设备的最大大小应大约为物理内存大小的1/2，因为这是可存储的最大潜在相关的数据量。例如，系统的物理内存为16GB，请考虑8GB的最大日志设备大小

    zpool create datap mirror c1t1d0 c1t2d0 mirror c1t3d0 c1t4d0 log mirror c1t5d0 c1t8d0     #使用镜像日志设备创建镜像存储池


使用高速缓存设备创建ZFS存储池：
    高速缓存设备在主内存和磁盘之间提供了一个进行高速缓存的附加层。使用高速缓存设备，可以最大程度地提高大多数静态内容的随机读取工作的性能。
        zpool create tanks /dev/sdd cache /dev/sde            #创建高速缓存池

    添加高速缓存设备之后，这些设备中将逐渐填充来自主内存的内容。填充设备可能需要一个小时以上的时间，具体取决于高速缓存设备的大小
    可以通过zpool iostat监视容量和读取操作
        zpool iostat -v tank 5
    创建池后，可以在池中添加高速缓存设备或从池中删除高速缓存设备

        确定是否使用高速缓存设备创建 ZFS 存储池时，请考虑以下几点：
            使用高速缓存设备，可以最大程度地提高大多数静态内容的随机读取工作的性能
            可以使用 zpool iostat 命令监视容量和读取操作
            创建池时，可以添加一个或多个高速缓存设备。也可以在创建池后添加或删除高速缓存设备
            高速缓存设备不能镜像或成为RAID-Z的一部分
            如果高速缓存设备发生读取错误，则会向原始存储池设备（它可能是镜像或RAID-Z的一部分）重新发出读取 I/O
            高速缓存设备的内容是易失性的，与其他系统高速缓存类似


创建存储池的注意事项
    请勿对属于现有存储池一部分的磁盘重新分区或重新设置标签。如果尝试对根磁盘重新分区或重新设置标签，可能需要重新安装OS
    创建存储池时，请勿包含来自其他存储池的组件（如文件或卷，这种配置不受支持，且会发生死锁。
    使用单个分区或单个磁盘创建的池没有冗余，会面临丢失数据的风险。使用多个分片创建的池如果没有冗余，也会面临丢失数据的风险
    未使用ZFS冗余（RAIDZ或镜像）创建的池只能报告数据不一致性，无法修复数据不一致性
    虽然使用ZFS冗余创建池有助于减少因硬件故障而导致的停机时间，但是这样的池仍不可避免地会受硬件故障、电源故障或电缆断开的影响。请确保定期备份您的数据


处理ZFS存储池创建错误：
    https://docs.oracle.com/cd/E26926_01/html/E25826/gaypw.html#scrolltoc       #参考


销毁ZFS存储池：
    池是通过使用 zpool destroy 命令进行销毁的。此命令会销毁池，即使池中包含挂载的数据集也是如此
        zpool destroy tank          #销毁tank池
    注意：销毁池时请务必小心。请确保确实要销毁池，并始终保留数据副本。如果意外销毁了不该销毁的池，则可以尝试恢复该池


管理存储池中的设备：（如果硬盘不够可以使用zpool destroy销毁以前创建的池）
    向基础池中添加设备：
        zpool create tank /dev/sdb              #创建池
        zpool add tank /dev/sdc                 #动态想池中添加设备，使用格式和zpool create相同，-f改变冗余级别，-n预运行
    向mirror中添加设备：
        zpool create tank mirror /dev/sdb /dev/sdc      #创建mirror池
        zpool add tank mirror /dev/sdd /dev/sde         #向mirror中添加设备
    RAID-Z中添加磁盘
        zpool create tank raidz /dev/sdb /dev/sdc       #创建raid-z池
        zpool add tank raidz /dev/sdd /dev/sde          #向raid-z中添加设备
    参考：https://docs.oracle.com/cd/E26926_01/html/E25826/gayrd.html#gazgw


存储池中的设备脱机和联机：
    使设备脱机：
        zpool offline tank /dev/adc         #永久脱机
        注意：不能将池 脱机到它出现故障的点。例如，不能使raidz1池中的两个设备脱机，也不能使顶层虚拟设备脱机

        默认情况下，脱机状态是持久性的。重新引导系统时，设备页会一直处于脱机状态
        zpool offline -t tank /dev/add      #暂时脱机，重新引导系统时，此设备会自动恢复到ONLINE状态

    使设备联机：
        zpool online tank /dev/sdc          #使设备联机
        注意：
          使设备联机时，已写入池中的任何数据都将与最新可用的设备重新同步
          不能通过使设备联机来替换磁盘。如果使设备脱机，然后替换该设备并尝试使其联机，则设备将一直处于故障状态


清除存储池设备错误：
    如果设备因出现故障（导致在 zpool status 输出中列出错误）而脱机，则可以使用 zpool clear 命令清除错误计数
    zpool clear tank                        #清除池中的所有出错
    zpool clear tank /dev/sdb               #清除池中指定设备的错误


替换存储池中的设备：
    zpool replace tank /dev/sdc /dev/sde              #将池中的sdc替换为sde
    替换磁盘的基本步骤：
        1、使用 zpool offline 命令使磁盘脱机（如有必要）
        2、移除要替换的磁盘
        3、插入替换磁盘
        4、运行 zpool replace 命令
        5、使用 zpool online 命令使磁盘联机
    注意：在具有 SATA 磁盘的某些系统上，必须先取消配置磁盘才能使其脱机。如果在该系统的同一插槽位置替换磁盘，则可以仅执行 zpool replace 命令

    替换ZFS池中的设备时，请考虑以下几点：
        1、如果将池属性 autoreplace 设置为 on，则会自动对在先前属于该池的设备的同一物理位置处找到的任何新设备进行格式化和替换，zpool replace
        2、如果在系统运行期间设备或热备件被物理移除，则会提供存储池状态 REMOVED。热备份设备（如果有）会替换移除的设备
        3、如果设备被移除后又重新插入，该设备将联机。如果重新插入设备时热备件处于激活状态，则热备件将在联机操作完成时被移除
        4、系统会定期检查热备件，以确保它们处于联机状态并可供使用
        5、替换设备的大小必须等于或大于镜像或 RAID-Z 配置中最小磁盘的大小
        6、替换较大池中的多个磁盘需要较长时间，这是因为需要将数据重新同步到新磁盘
        7、建议在两次磁盘替换操作之间运行 zpool scrub 命令，以确保可供替换的设备可以正常运行，并且正确写入数据
        8、如果已使用热备件自动替换了故障磁盘，则您可能需要在替换故障磁盘后分离该热备件。使用zpool detach命令从镜像池或RAID-Z池中分离备件
    大盘替换小盘：
        1、将大于替换设备的设备添加到池中后，它不会自动扩展到相应大小
        2、池属性 autoexpand 的值决定当磁盘添加到池中时，是否将替换 LUN 扩展到其完整大小
        3、默认情况下，autoexpand 属性禁用，您可以在将较大的 LUN 添加到池中之前或之后，启用此属性以扩展 LUN 大小
          zpool set autoexpand=on tank        #启用autoexpand属性


在存储池中指定热备件：
    指定设备作为热备件意味着该设备不是池中的活动设备，但如果池中的某一活动设备发生故障，热备件将自动替换该故障设备
        使用 zpool create 命令创建池时
            zpool create tank mirror /dev/sdb /dev/sdc spare /dev/sdd /dev/sde      #创建池并指定热备(关键字spare)
        使用 zpool add 命令创建池之后
            zpool create tank mirror /dev/sdb /dev/sdc      #创建池
            zpool add tank spare /dev/sdd                   #添加热备

        删除热备：
            zpool remove tank /dev/sdd        #删除热备，如果存储池当前正在使用热备件，则不能将其删除

        注意：
            1、目前，zpool remove 命令只能用来删除热备件、高速缓存设备和日志设备
            2、要添加磁盘作为热备件，热备件的大小必须等于或大于池中最大磁盘的大小，允许向池中添加更小的磁盘作为备件，但是当激活较小的备用磁盘时，操作将失败


在存储池中激活和取消激活热备件：
    手动替换：通过 zpool replace 命令用热备件替换存储池中的故障设备
    自动替换：检测到故障后，FMA 代理将检查池中是否有任何可用的热备件。如果有，将使用可用备件替换故障设备

    如果将故障设备物理替换为活动备件，则可以使用 zpool detach 命令分离该备件，从而重新激活原设备
    如果将 autoreplace 池属性设置为 on，则在插入新设备并完成联机操作后，该备件会自动分离并回到备件池

        zpool replace zeepool /dev/sdb        #使用热备替换sdb
        zpool detach zeepool /dev/sdd         #分离热备(使热备件回到备份池)

    分离故障磁盘并使用热备件：
    如果您想临时或永久性地换入当前正在替换故障磁盘的热备件以替换磁盘，请分离故障磁盘。故障磁盘完成替换后，可以将其再添加到存储池用作备件
        zpool detach tank /dev/sdc            #分离故障盘
        zpool add tank spare /dev/sde         #使用热备替换故障盘


https://docs.oracle.com/cd/E26926_01/html/E25826/gaypw.html#scrolltoc           #参考
